<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Kahoot Jugador</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; text-align: center; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .pregunta-box { border: 2px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 5px; }
        .opcion-btn { padding: 15px 30px; margin: 10px; cursor: pointer; font-size: 1.2em; border: none; border-radius: 8px; color: white; width: 100%; transition: background-color 0.3s; }
        #A-btn { background-color: #4CAF50; }
        #B-btn { background-color: #2196F3; }
        #C-btn { background-color: #FF9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="game-title">Kahoot de Redes</h1>
        <div id="join-form">
            <input type="text" id="nombre-input" placeholder="Ingresa tu nombre" required style="padding: 10px; width: 80%; margin-bottom: 10px;">
            <button onclick="unirseAlJuego()" style="background-color: #555;">Unirse</button>
        </div>

        <div id="game-area" style="display:none;">
            <p>Conectado como: <strong id="player-name"></strong></p>
            <div class="pregunta-box">
                <h2 id="pregunta-texto">Esperando que el Administrador inicie el juego...</h2>
                <div id="opciones-area">
                    </div>
            </div>
            <p id="mensaje-servidor" style="color: red; margin-top: 15px;">Mensajes del Servidor.</p>
        </div>
    </div>

    <script>
        const socket = io(); 
        let nombreJugador = '';

        function unirseAlJuego() {
            nombreJugador = document.getElementById('nombre-input').value.trim();
            if (nombreJugador) {
                socket.emit('conectar_jugador', {nombre: nombreJugador});
                document.getElementById('join-form').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';
                document.getElementById('player-name').textContent = nombreJugador;
            }
        }

        function enviarRespuesta(opcion) {
            // Deshabilita los botones inmediatamente para evitar múltiples respuestas
            document.querySelectorAll('.opcion-btn').forEach(btn => btn.disabled = true);
            
            socket.emit('enviar_respuesta', {respuesta: opcion});
        }

        // --- Manejadores de Eventos Socket.IO ---

        socket.on('mensaje', (msg) => {
            // Mensajes individuales del servidor (ej. "¡Correcto!")
            document.getElementById('mensaje-servidor').textContent = msg;
            // Si es respuesta, re-habilitar si el juego sigue activo (opcional)
        });
        
        socket.on('mensaje_broadcast', (msg) => {
            // Mensajes para todos (ej. "El juego ha finalizado")
            document.getElementById('mensaje-servidor').textContent = msg;
        });

        socket.on('nueva_pregunta', (data) => {
            // Nueva pregunta
            document.getElementById('pregunta-texto').textContent = data.texto;
            const opcionesArea = document.getElementById('opciones-area');
            opcionesArea.innerHTML = '';
            
            // Crea los botones de opción
            data.opciones.forEach((opcion, index) => {
                const letra = ['A', 'B', 'C'][index];
                const btn = document.createElement('button');
                btn.id = `${letra}-btn`;
                btn.className = 'opcion-btn';
                btn.textContent = `${letra}) ${opcion}`;
                btn.addEventListener('click', () => enviarRespuesta(letra));
                opcionesArea.appendChild(btn);
            });
            
            document.getElementById('mensaje-servidor').textContent = '¡Ronda iniciada! Selecciona tu respuesta.';
        });
        
        socket.on('actualizar_puntuacion', (scores) => {
            // Muestra la puntuación del jugador actual
            const currentScore = Object.values(scores).find(info => info.nombre === nombreJugador);
            if (currentScore) {
                document.getElementById('game-title').textContent = `Puntuación: ${currentScore.puntuacion}`;
            }
        });
    </script>
</body>
</html>